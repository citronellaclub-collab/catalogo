<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GTL</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #1e1e1e;
  color: #f2f2f2;
}

header {
  background: #2c2c2c;
  padding: 10px 16px;
  border-bottom: 2px solid #333;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.token {
  color: #3dff7a;
  font-weight: bold;
}

.tabs {
  display: flex;
  background: #252525;
}

.tab {
  padding: 8px 14px;
  cursor: pointer;
}

.tab.active {
  background: #1e1e1e;
  border-bottom: 2px solid #3d7eff;
}

.view { display: none; padding: 12px; }
.view.active { display: block; }

input, button {
  width: 100%;
  margin-bottom: 6px;
  padding: 6px;
  background: #1a1a1a;
  border: 1px solid #444;
  color: #fff;
}

button {
  background: #3d7eff;
  cursor: pointer;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
}

.item {
  background: #2b2b2b;
  border: 2px solid #3a3a3a;
  padding: 8px;
  text-align: center;
}

.item img {
  width: 48px;
  height: 48px;
}

.buy-btn {
  background: #2fa866;
}

.dev-panel, .modal {
  position: fixed;
  background: #252525;
  border: 2px solid #444;
  padding: 12px;
}

.dev-panel {
  right: 10px;
  bottom: 10px;
  width: 220px;
  display: none;
}

.modal {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 260px;
  display: none;
}
</style>
</head>

<body>

<header>
  <strong>Global Trade Link</strong>
  <div>Tokens: <span id="tokenCount" class="token">5000 游릭</span></div>
</header>

<div class="tabs">
  <div class="tab active" onclick="switchView('buscar', this)">Buscar</div>
  <div class="tab" onclick="switchView('publicar', this)">Publicar</div>
  <div class="tab" onclick="toggleDev()">Modo Dev</div>
</div>

<div id="buscar" class="view active">
  <div class="grid" id="grid"></div>
</div>

<div id="publicar" class="view">
  <input id="pName" placeholder="Nombre">
  <input id="pPrice" type="number" placeholder="Precio">
  <input id="pQty" type="number" placeholder="Cantidad">
  <input id="pImg" type="file" accept="image/*">
  <button onclick="publishItem()">Publicar</button>
</div>

<!-- DEV -->
<div class="dev-panel" id="devPanel">
  <img id="devImg">
  <input id="editName">
  <input id="editPrice" type="number">
  <input id="editQty" type="number">
  <input id="editImg" type="file" accept="image/*">
  <button onclick="saveEdit()">Guardar</button>
</div>

<!-- MODAL ADQUIRIR -->
<div class="modal" id="buyModal">
  <h3 id="buyName"></h3>
  <input id="buyQty" type="number" min="1">
  <p>Total: <span id="buyTotal" class="token"></span></p>
  <button onclick="confirmBuy()">Confirmar</button>
  <button onclick="closeModal()">Cancelar</button>
</div>

<script>
let items = [];
let selectedIndex = null;
let buyIndex = null;
let tokens = 5000;

function fileToBase64(f, cb) {
  const r = new FileReader();
  r.onload = () => cb(r.result);
  r.readAsDataURL(f);
}

function render() {
  tokenCount.textContent = tokens + " 游릭";
  grid.innerHTML = "";
  items.forEach((item, i) => {
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `
      <img src="${item.img}">
      <h4>${item.name}</h4>
      <p class="token">${item.price} 游릭</p>
      <p>Stock: ${item.qty}</p>
      <button class="buy-btn">Adquirir</button>
    `;
    d.querySelector("button").onclick = () => openBuy(i);
    d.onclick = () => selectItem(i);
    grid.appendChild(d);
  });
}

function publishItem() {
  fileToBase64(pImg.files[0], img => {
    items.push({
      name: pName.value,
      price: +pPrice.value,
      qty: +pQty.value,
      img
    });
    render();
  });
}

function selectItem(i) {
  selectedIndex = i;
  const it = items[i];
  editName.value = it.name;
  editPrice.value = it.price;
  editQty.value = it.qty;
  devImg.src = it.img;
}

function saveEdit() {
  const it = items[selectedIndex];
  it.name = editName.value;
  it.price = +editPrice.value;
  it.qty = +editQty.value;

  if (editImg.files[0]) {
    fileToBase64(editImg.files[0], img => {
      it.img = img;
      devImg.src = img;
      render();
    });
  } else render();
}

function toggleDev() {
  devPanel.style.display =
    devPanel.style.display === "block" ? "none" : "block";
}

function openBuy(i) {
  buyIndex = i;
  buyName.textContent = items[i].name;
  buyQty.value = 1;
  updateBuyTotal();
  buyModal.style.display = "block";
}

function updateBuyTotal() {
  buyTotal.textContent =
    buyQty.value * items[buyIndex].price + " 游릭";
}

buyQty.oninput = updateBuyTotal;

function confirmBuy() {
  const qty = +buyQty.value;
  const cost = qty * items[buyIndex].price;
  if (qty > items[buyIndex].qty) return alert("Stock insuficiente");
  if (cost > tokens) return alert("Tokens insuficientes");

  items[buyIndex].qty -= qty;
  tokens -= cost;
  closeModal();
  render();
}

function closeModal() {
  buyModal.style.display = "none";
}

items.push({
  name: "Item de prueba",
  price: 100,
  qty: 10,
  img: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAFElEQVR42mNk+M9Qz0AEYBxVSF8AAF4fA8m4a9jLAAAAAElFTkSuQmCC"
});

render();
</script>

</body>
</html>


