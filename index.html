<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GTL - CatÃ¡logo</title>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #1e1e1e;
  color: #f2f2f2;
}

header {
  background: #2c2c2c;
  padding: 10px 16px;
  border-bottom: 2px solid #3a3a3a;
}

.token {
  color: #3dff7a;
  font-weight: bold;
}

.tabs {
  display: flex;
  background: #252525;
  border-bottom: 2px solid #333;
}

.tab {
  padding: 8px 14px;
  cursor: pointer;
  font-size: 13px;
  border-right: 1px solid #333;
}

.tab.active {
  background: #1e1e1e;
  border-bottom: 2px solid #3d7eff;
}

.view {
  display: none;
  padding: 12px;
}

.view.active {
  display: block;
}

input, button {
  background: #1a1a1a;
  border: 1px solid #444;
  color: #fff;
  padding: 6px;
  margin-bottom: 6px;
  font-size: 12px;
}

button {
  background: #3d7eff;
  cursor: pointer;
}

button:hover {
  background: #5a93ff;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
}

.item {
  background: #2b2b2b;
  border: 2px solid #3a3a3a;
  border-radius: 6px;
  padding: 8px;
  text-align: center;
  cursor: pointer;
}

.item img {
  width: 48px;
  height: 48px;
}

.buy-btn {
  width: 100%;
  background: #2fa866;
  margin-top: 6px;
}

.dev-panel {
  position: fixed;
  right: 10px;
  bottom: 10px;
  width: 220px;
  background: #252525;
  border: 2px solid #444;
  padding: 10px;
  display: none;
}
</style>
</head>

<body>

<header>
  <strong>Global Trade Link</strong> â€”
  Tokens: <span class="token" id="tokenCount">5000 ðŸŸ¢</span>
  <button onclick="toggleDev()" style="float:right">Modo Dev</button>
</header>

<div class="tabs">
  <div class="tab active" onclick="switchView('buscar', this)">Buscar</div>
  <div class="tab" onclick="switchView('publicar', this)">Publicar</div>
</div>

<!-- BUSCAR -->
<div id="buscar" class="view active">
  <input id="search" placeholder="Buscar item..." oninput="render()">
  <div class="grid" id="grid"></div>
</div>

<!-- PUBLICAR -->
<div id="publicar" class="view">
  <h3>Publicar Item</h3>
  <input id="pName" placeholder="Nombre">
  <input id="pPrice" type="number" placeholder="Precio en tokens">
  <input id="pQty" type="number" placeholder="Cantidad">
  <input id="pImg" type="file" accept="image/*">
  <button onclick="publishItem()">Publicar</button>
</div>

<!-- DEV PANEL -->
<div class="dev-panel" id="devPanel">
  <h4>Editor de Item</h4>
  <img id="devImg" style="width:48px;height:48px;display:block;margin-bottom:6px">
  <input id="editName" placeholder="Nombre">
  <input id="editPrice" type="number" placeholder="Precio">
  <input id="editQty" type="number" placeholder="Cantidad">
  <input id="editImg" type="file" accept="image/*">
  <button onclick="saveEdit()">Guardar</button>
</div>

<script>
let items = [];
let selectedIndex = null;
let tokens = 5000;

function fileToBase64(file, cb) {
  const reader = new FileReader();
  reader.onload = () => cb(reader.result);
  reader.readAsDataURL(file);
}

function switchView(id, el) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  el.classList.add('active');
}

function render() {
  document.getElementById('tokenCount').textContent = tokens + ' ðŸŸ¢';
  const grid = document.getElementById('grid');
  const q = search.value.toLowerCase();
  grid.innerHTML = '';

  items.filter(i => i.name.toLowerCase().includes(q)).forEach((item, i) => {
    const div = document.createElement('div');
    div.className = 'item';
    div.onclick = () => selectItem(i);

    div.innerHTML = `
      <img src="${item.img}">
      <h3>${item.name}</h3>
      <p class="token">${item.price} ðŸŸ¢</p>
      <p>Stock: ${item.qty}</p>
      <button class="buy-btn">Adquirir</button>
    `;

    div.querySelector('.buy-btn').onclick = e => {
      e.stopPropagation();
      acquireItem(i);
    };

    grid.appendChild(div);
  });
}

function publishItem() {
  const file = pImg.files[0];
  if (!pName.value || !pPrice.value || !pQty.value || !file)
    return alert('Completa todos los campos');

  fileToBase64(file, img => {
    items.push({
      name: pName.value,
      price: Number(pPrice.value),
      qty: Number(pQty.value),
      img
    });
    render();
  });
}

function acquireItem(i) {
  const item = items[i];
  if (item.qty <= 0) return alert('Sin stock');
  if (tokens < item.price) return alert('Tokens insuficientes');
  tokens -= item.price;
  item.qty--;
  render();
}

function selectItem(i) {
  selectedIndex = i;
  const item = items[i];
  editName.value = item.name;
  editPrice.value = item.price;
  editQty.value = item.qty;
  devImg.src = item.img;
}

function saveEdit() {
  if (selectedIndex === null) return;
  const item = items[selectedIndex];
  item.name = editName.value;
  item.price = Number(editPrice.value);
  item.qty = Number(editQty.value);

  const file = editImg.files[0];
  if (file) {
    fileToBase64(file, img => {
      item.img = img;
      devImg.src = img;
      render();
    });
  } else render();
}

function toggleDev() {
  devPanel.style.display =
    devPanel.style.display === 'block' ? 'none' : 'block';
}

/* Item inicial */
items.push({
  name: 'Item de prueba',
  price: 100,
  qty: 10,
  img: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAFElEQVR42mNk+M9Qz0AEYBxVSF8AAF4fA8m4a9jLAAAAAElFTkSuQmCC'
});

render();
</script>

</body>
</html>
